![눈코캐 배경](https://user-images.githubusercontent.com/116439064/215262105-c40a7151-df8d-4439-bb9f-c35c4739f603.png)
# 눈치 코치 캐치 : TRY'S KETCH !

## ✨ 프로젝트 소개

#### 보이스 채팅과 함께 즐기는 드로잉 게임입니다 !!

### 🪄 주요 기능
- `보이스 채팅` 실시간으로 진행되는 상황에 대해서 즐겁게 대화를 하면서 플레이 하시고 최종적으로 모두가 함께 그린 그림들을 보면서 즐겨주세요
- `스케치북` 상상력을 발휘해 마음껏 그림을 그려주세요

### 📆 프로젝트 기간

> 2022.12.30 ~ 2022.02.17
> 서비스 런칭 : 2022.01.28


### 🙋🏻‍♀️🙋🏻 프로젝트 멤버 (이름을 클릭하시면 깃허브로 이동할 수 있습니다.)

|[🔰·장신원](https://github.com/synuns)|[이민규](https://github.com/GosuEE)|[🔰·안은솔](https://github.com/eunsol-an)|[김재영](https://github.com/code0613)|[서혁수](https://github.com/SHsus1122)|[황미경](https://github.com/beautifulseoul)|조문정|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|![장신원](https://user-images.githubusercontent.com/116439064/215262142-47067e5c-59ab-4097-aa89-9c1ca56199c8.png)|![이민규](https://user-images.githubusercontent.com/116439064/215262141-5c84b7e9-1a76-4c89-93a9-9b2f404f829a.png)|![안은솔](https://user-images.githubusercontent.com/116439064/215262140-71f4049c-30c5-4bf3-8072-af2b3ebc7ec9.png)|![김재영](https://user-images.githubusercontent.com/116439064/215262138-c0d1dddd-0394-454e-b721-75269dc1bdb4.png)|![서혁수](https://user-images.githubusercontent.com/116439064/215262139-23bf246f-f9f2-4703-a367-8af22628c549.png)|![황미경](https://user-images.githubusercontent.com/116439064/215262240-af881f71-ac78-4b7a-8e6d-f0cd32ff044b.png)|![눈치](https://user-images.githubusercontent.com/116439064/215262505-ac96ba3e-ead6-48a7-be78-ec5ede37e626.png)|
|FRONT-END|FRONT-END|BECK-END|BECK-END|BECK-END|BECK-END|DESIGN|

### 👉🏻 [게임 한판 하러 가시죠 !](https://trys-ketch.com/)  
### 👉🏻 [눈코캐 팀 노션은 여기입니다 !](https://www.notion.so/synuns/Try-s-Ketch-e2f580b6f6424e5bb85d2f23d29cdcfe)

[//]: # (### 🎬 시연 및 소개영상)

[//]: # ([영상 링크]&#40;#&#41;)

[//]: # ()
[//]: # (### 🎮 실제 플레이 화면)

[//]: # (이곳에 이미지 넣어주세요)


### 📒 기술스택
####  프론트
<img src="https://img.shields.io/badge/HTML-E34F26?style=for-the-badge&logo=HTML5&logoColor=white"/> <img src="https://img.shields.io/badge/styled components-DB7093?style=for-the-badge&logo=styled-components&logoColor=white"/> <img src="https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=JavaScript&logoColor=black"/> <img src="https://img.shields.io/badge/Redux Toolkit-764ABC?style=for-the-badge&logo=Redux&logoColor=white"/> <br> <img src="https://img.shields.io/badge/React-61DAFB?style=for-the-badge&logo=React&logoColor=black"/> <img src="https://img.shields.io/badge/Axios-5A29E4?style=for-the-badge&logo=Axios&logoColor=white"/> <img src="https://img.shields.io/badge/WebRTC-333333?style=for-the-badge&logo=WebRTC&logoColor=white"/> <img src="https://img.shields.io/badge/GitHub Actions-2088FF?style=for-the-badge&logo=GitHub Actions&logoColor=white"/> <img src="https://img.shields.io/badge/sockjs-333333?style=for-the-badge&logo=sockjs&logoColor=white"/> <img src="https://img.shields.io/badge/stomp-333333?style=for-the-badge&logo=stomp&logoColor=white"/>

#### 백엔드
<img src="https://img.shields.io/badge/Spring-6DB33F?style=for-the-badge&logo=Spring&logoColor=white"/> <img src="https://img.shields.io/badge/Spring Boot-6DB33F?style=for-the-badge&logo=Spring Boot&logoColor=white"/> <img src="https://img.shields.io/badge/Spring Security-6DB33F?style=for-the-badge&logo=Spring Security&logoColor=white"/> <img src="https://img.shields.io/badge/JWT Token-333333?style=for-the-badge&logo=JWT Token&logoColor=white"/>  
<img src="https://img.shields.io/badge/Redis-DC382D?style=for-the-badge&logo=Redis&logoColor=white"/>  <img src="https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=MySQL&logoColor=white"/> <br> <img src="https://img.shields.io/badge/Amazon RDS-527FFF?style=for-the-badge&logo=Amazon RDS&logoColor=white"/> <img src="https://img.shields.io/badge/Amazon S3-569A31?style=for-the-badge&logo=Amazon S3&logoColor=white"/>  
<img src="https://img.shields.io/badge/Amazon EC2-FF9900?style=for-the-badge&logo=Amazon EC2&logoColor=white"/> <img src="https://img.shields.io/badge/WebRTC-333333?style=for-the-badge&logo=WebRTC&logoColor=white"/> <img src="https://img.shields.io/badge/sockjs-333333?style=for-the-badge&logo=sockjs&logoColor=white"/> <img src="https://img.shields.io/badge/stomp-333333?style=for-the-badge&logo=stomp&logoColor=white"/> <img src="https://img.shields.io/badge/GitHub Actions-2088FF?style=for-the-badge&logo=GitHub Actions&logoColor=white"/>

### 🧱 ERD
![ERD](https://user-images.githubusercontent.com/116439064/215262318-5fd0ce84-f30f-486a-9b42-80f1aac02f6a.png)

### 🏗️ 서비스 아키텍처
![서비스 아키텍쳐](https://user-images.githubusercontent.com/116439064/215262310-f5df37f4-2094-4f49-9d65-e11ed70ea709.png)

### 🤔️ 기술적 의사 결정
<details>
<summary>우리는 이렇게 생각하고 결정했습니다 !</summary>

#### ✔️ 계층형 디렉토리 구조
|진행순서|상세내용|
|:---|:---|
|도입이유|개발단계에서 프로젝트의 구조를 빠르게 파악하기 위해 도입|
|문제상황|도메인형 계층구조가 직관적이긴 하나 개발 단계에서 도메인의 추가에 따라 접근성이 떨어짐|
|해결방안|계층형 디렉토리 구조로 변경|
|의견조율|- 현재 프로젝트가 한 계층에 포함되는 클래스의 수도 많지 않음<br/>- 프로젝트의 규모가 크지 않음|
|의견결정|기존 도메인형 계층구조를 도입할려고 하였으나 프로젝트의 규모와 무엇보다 접근성으로 인해 계층형 디렉토리 구조로 변경하기로 결정|

#### ✔️ WebRTC 방식(p2p vs SFU)
|진행순서|상세내용|
|:---|:---|
|도입이유|게임을 하며 음성 채팅이 가능하도록 하기 위해서는 WebRTC 도입이 필수적|
|문제상황|최대 8명의 음성 채팅을 위해 WebRTC의 어떤 방식이 알맞을지에 대한 고민|
|해결방안|1. Mesh : 클라이언트 간의 다중 연결 방식<br/>- 장점 : 서버 자원을 사용하지 않는다.<br/>- 단점 : 클라리언트의 네트워크 I/O 부하가 발생할 가능성 있다.<br/>2. SFU : 서버를 이용하여 클라이언트의 미디어 스트림을 중계하는 역할을 수행하게 하는 방식<br/>- 장점 : 다대다 WebRTC 연결방식 중 클라이언트의 부하가 적다.<br/>- 단점 : 서버를 구현하는 난이도가 높아진다.|
|의견조율|- 방에 입장할 수 있는 인원이 최대 8명으로 고정되어 있어 클라이언트의 부하가 크지 않을 것 이라고 생각<br/>- SFU 방식을 선택하게 되면 하나의 서버를 더 관리해야 하므로 현재 프로젝트 규모와 맞지 않음|
|의견결정|성능적 측면에서도 더 유리한 Mesh(p2p)방식으로 결정|

#### ✔️ WebSocket + STOMP
|진행순서|상세내용|
|:---|:---|
|도입이유|게임 메인 로직 개발 중 websocket을 더 편리하게 사용하기 위하여 도입|
|문제상황|websocket을 이용하여 서버와 통신을 했을 때 webSocketSession 관리를 위해 서버단에서 코드가 지나치게 복잡해지는 문제와 정형화된 타입이 없어 코드 예외 처리가 까다로운 문제 발생|
|해결방안|STOMP 적용|
|의견조율|STOMP는 간단한 텍스트 지향 메시징 프로토콜로 메시징 통합을 위한 구현하기 쉬운 와이어 프레임 기반으로 구현되어 있어 여러 에러 처리를 간단하게 해줌|
|의견결정|게임 메인 로직과 채팅 기능에 STOMP를 적용하여 사용하기로 결정|

#### ✔️ RDBMS ( Mysql ) 선정
|진행순서|상세내용|
|:---|:---|
|도입이유|프로젝트에서 데이터를 저장할 메인 데이터베이스를 선정함|
|문제상황|현재 프로젝트에 알맞은 성격의 데이터베이스를 선정 해야 함|
|해결방안|1, Amazon Aurora<br/>2, MySQL<br/>3, MariaDB<br/>4, PostgreSQL<br/>5, Oracle<br/>6, MS SQL Server|
|의견조율|- 기본적으로 RDBMS를 사용함<br/>- 데이터 구조가 명확하며 데이터 무결성이 보장되어야 함<br/>- 데이터베이스 서버를 직접 운영하지 않고 AWS RDS를 사용할 예정<br/>- 프로젝트 조직이 Mysql에 익숙함<br/>- 비용발생이 하지 않으면 좋음|
|의견결정|설치 및 사용의 용이성과 프로젝트의 성격과 규모를 고려하여 MySQL을 사용하기로 결정|

#### ✔️ Redis를 비회원에 사용한 이유
|진행순서|상세내용|
|:---|:---|
|도입이유|게임을 이용할 사람들이 회원가입을 하지 않고도 편하게 게임을 진행할 수 있게 하기 위함|
|문제상황|유저가 아닌 비회원으로 접속한 유저들에 대한 정보를 MySQL 에 저장 하는 것이 맞는지에 대한 고민|
|해결방안|1. [MySQL] 회원 테이블과 같이 쓰되 비회원을 위해서 null 값을 허용<br/>2. [MySQL] 비회원용 테이블 자체를 따로 생성해서 사용<br/>3. [Redis] 비회원 로그인시 계정 생성, 일정 시간 이후 만료|
|의견조율|- 테이블에 기본적으로 null 값이 들어가면 데이터의 무결성이 문제가 있다.<br/>- 회원 비회원 테이블이 따로 나뉘면 나중에 관리하기가 힘들어진다.<br/>- MySQL 에 비회원을 사용하기엔 리소스 낭비<br/>- Redis 를 적용할 경우 추후 다른 곳에도 활용 가능성이 있다.|
|의견결정|초기에 생성 이후 변경이 없기에 읽기속도가 뛰어나며, 휘발성 데이터이기 때문에 굳이 MySQL 을 이용할 필요가 없다.<br/>또한 생성시에 만료시간 설정도 가능하기에 Redis가 적합하다고 판단해서 Redis를 이용하기로 결정|

#### ✔️ SSE 방식 선정
|진행순서|상세내용|
|:---|:---|
|도입이유|게임방이 생성되고 소멸되는 것을 실시간으로 보여주기 위함|
|문제상황|웹소켓으로 데이터 보여줄 경우 서버의 부하가 우려되고, Http방식은 실시간성 보장이 어려운 상황|
|해결방안|리소스와 실시간성 두가지 측면을 고려해야 했음<br/>1. polling은 구현이 간단하나 실시간성과 리소스 효율 측면 중 하나는 포기해야 함<br/>2. long-polling은 변경에 즉각적으로 반응하여 실시간으로 통신이 가능하나, 데이터 변화가 잦다면 polling보다 훨씬 더 많은 데이터를 보내야 함<br/>3. websocket은 실시간성이 보장되나, 연결을 유지해야하기 때문에 서버의 부하가 발생할 수 있음<br/>4. SSE는 재접속 처리 등의 저수준 처리가 자동으로 이루어진다는 장점이 있으나, 서버에서 클라이언트로 요청은 초기 한 번만 가능하다는 단점이 있음|
|의견조율|- 클라이언트와 서버측의 상호작용이 필요없음<br/>- 실시간성 보장 필요|
|의견결정|서버에서 클라이언트로 단방향 통신이 필요하므로, 상호작용 없이 서버로부터 데이터가 전달되어야 하는 상황에 적합한 SSE방식을 채택|

#### ✔️️️️ Spring Scheduler 사용
|진행순서|상세내용|
|:---|:---|
|도입이유|그림을 DB에 저장하여 게임 중 데이터 손실을 방지하고, 동시에 필요없는 데이터를 주기적으로 없애기 위함|
|문제상황|게임 진행하며 생성되는 모든 사진들을 S3에 저장하기에는 S3 저장용량에 부담된다.<br/>하지만 게임 중 데이터의 손실을 방지하기 위해 저장은 필요한 상황|
|해결방안|1. 클라이언트에서 그림 데이터 가지고 있다가, 좋아요 눌린 시점에 데이터 서버로 보내서 DB에 저장<br/>2. 모든 사진을 서버로 받아와 저장 후 좋아요 안 눌린 그림 삭제|
|의견조율|그림 데이터를 클라이언트측에서 가지고있을 수 있지만, 메인로직에서 다뤄지는 주요 데이터는 서버에 저장하는 것이 맞다고 판단|
|의견결정|모든사진을 S3에 저장하고, 그 중 좋아요가 눌리지 않은 그림은 주기적으로 삭제하도록 Spring Scheduler 이용하여 구현|

</details>


[//]: # (### 🛠️ 트러블슈팅)

[//]: # (<details>)

[//]: # (<summary>프론트가 겪은 고통</summary>)

[//]: # ()
[//]: # (#### 문제 내용 입니다)

[//]: # (- 😱 문제  )

[//]: # (  문제 내용 적어주세요)

[//]: # (- 😭 시도  )

[//]: # (  시도했었던 것에 관한 내용을 적어주세요)

[//]: # (- 😄 해결  )

[//]: # (  어떻게 해결했는지에 대해서 적어주세요)

[//]: # ()
[//]: # (</details>)

[//]: # (<details>)

[//]: # (<summary>백엔드가 겪은 고통</summary>)

[//]: # ()
[//]: # (#### 동시성 문제)

[//]: # (- 😱 문제  )

[//]: # (  유저게 게임방에 들어오는 과정에서 동시에 여러명의 유저가 방에 입장을 할 경우 일부는 입장이 불가능한 문제가 있습니다.  )

[//]: # (  저희는 이것을 `동시성의 문제` 라고 판단하고 여러가지 시도를 해 봤습니다.)

[//]: # (- 😭 시도  )

[//]: # (  - 비관적 락  )

[//]: # (  `@Lock` 어노테이션을 사용해서 트랜잭션 격리, 아를 어노테이션의 모든 속성들에 한번씩 다 시도했습니다.)

[//]: # (  - Java - synchronized 스레드 동기화  )

[//]: # (  현재 `enterGameRoom` 메소드 즉, 유저가 입장하는 메소드가 실행될 때 문제가 발생한다 생각해서 여기에서 시도했습니다.)

[//]: # (  - Service 단이 아닌 Controller 단에도 붙혀서 시도했습니다.)

[//]: # (- 😄 해결  )

[//]: # (  현재는 사용중인 DB 의 Transaction Isolation level 을 격상했습니다)

[//]: # ()
[//]: # (#### SSE 적용 관련)

[//]: # (- 😱 문제  )

[//]: # (  emitter 시간 설정을 길게 두면 성능 때문에 에러 발생  )

[//]: # (  &#40;IOException : broken pipe, Connection is not available. requested timed out after 30004ms 에러가 번갈아 뜸&#41;)

[//]: # (- 😭 시도  )

[//]: # (  - 시간 설정을 짧게 해서 시도해 보았지만 새로 바뀌는 정보 잘 받아오나, 지정 시간 끝난 이후에는 새로 정보를 받아오지 못했습니다.)

[//]: # (- 😄 해결  )

[//]: # ()
[//]: # (#### WebSocket 연결 문제)

[//]: # (- 😱 문제  )

[//]: # (  우선은 간단한 예제를 통해 서버와 클라이언트가 웹소켓으로 통신을 시도해 보았으나 에러가 발생 했습니다  )

[//]: # (  <img src="//www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb3857311-941d-406a-810d-3152920b97b8%2FUntitled.png?id=0bdef261-c3f9-4b7e-8bb8-342181a005b9&table=block&spaceId=bf09b777-9960-428c-ac62-1b9a430795b2&width=2000&userId=8c6a0bef-a0e5-4e91-a1f1-3563a4af6905&cache=v2" width="500"/>)

[//]: # (- 😭 시도  )

[//]: # (  - 프론트와 함께 맞춰가는 과정에서 똑같은 코드를 cra 해서 수정하고 확인한 결과 vite 라는 것이 문제였습니다 !)

[//]: # (    <img src="https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F031ee58a-2f73-4287-83bf-3cdaa08b4e3f%2FUntitled.png?id=df5c6bda-7662-45a0-aff3-514bde1ccf07&table=block&spaceId=bf09b777-9960-428c-ac62-1b9a430795b2&width=2000&userId=8c6a0bef-a0e5-4e91-a1f1-3563a4af6905&cache=v2" width="700"/>)

[//]: # (- 😄 해결  )

[//]: # ()
[//]: # (#### 문제 내용 입니다)

[//]: # (- 😱 문제  )

[//]: # (  문제 내용 적어주세요)

[//]: # (- 😭 시도  )

[//]: # (  시도했었던 것에 관한 내용을 적어주세요)

[//]: # (- 😄 해결  )

[//]: # (  어떻게 해결했는지에 대해서 적어주세요)

[//]: # ()
[//]: # (</details>)
